---
title: "Weissman-replication-source-raw"
author: "Marton Kovacs"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

# Load packages
```{r}
library(tidyverse)
library(glue)
library(janitor)
library(osfr)
```

# Download data from OSF
## OSF auth (until project is public)
```{r}
osf_auth(token = read_lines("osf_token_write_martonbalazskovacs.txt"))
```

## Connect to data OSF folder
```{r}
data_guid <- "9knds"

weissman_project <- osf_retrieve_node(data_guid)
```

# Import and merge data
```{r}
## Function to save subdirectories and filename as a variable
read_plus <- function(pattern = ".csv$", path = "Source/", subfolder_name = subfolder_name, exclude = "demographics.csv$") {
  list.files(path = paste0(path, subfolder_name), pattern = pattern, full.names = T, recursive = T) %>% 
    .[ !grepl(exclude, .) ] %>% 
    map(.,
        ~ read_csv(.x) %>% 
          mutate(data_type = str_extract(.x, "[^/]+"),
                 filename = str_remove_all(.x, ".*/|.csv"),
                 task = str_extract(.x, "(?<=/).*?(?=/)")))
}

# Saving subfolder names
subfolder <- list("Primeprobe", "Flanker", "Stroop", "Simon")

# Read in response datafiles
source_task_response <-
  tibble(task = subfolder,
         content = map(subfolder,
                       ~ read_plus(subfolder_name = .x)))
source_task_response$content %>% View()

# Test osfr
weissman_project %>% 
  osf_ls_files(path = "Source", type = "folder") %>%
  filter(name == "simon") %>% 
  osf_ls_files(pattern = "demographics.csv") %>% 
  osf_download(overwrite = T) 
```